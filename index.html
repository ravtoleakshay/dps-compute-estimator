<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MES Storage & Compute Estimator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap 5 CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <style>
      body {
        background-color: #f5f7fb;
      }
      .card {
        border-radius: 1rem;
      }
      .results-badge {
        font-size: 0.9rem;
      }
      .section-title {
        font-weight: 600;
        letter-spacing: 0.03em;
        text-transform: uppercase;
        color: #6c757d;
        font-size: 0.8rem;
      }
      .module-list {
        max-height: 240px;
        overflow-y: auto;
        border-radius: 0.5rem;
        border: 1px solid #dee2e6;
        padding: 0.75rem;
        background-color: #ffffff;
      }
      .small-label {
        font-size: 0.8rem;
        color: #6c757d;
      }
    </style>
  </head>
  <body>
    <div class="container py-4 py-md-5">
      <header class="mb-4 text-center">
        <h1 class="h3 mb-1">MES Storage & Compute Estimator</h1>
        <p class="text-muted mb-0">
          Quick sizing for TimescaleDB storage and application CPU/RAM based on
          assets, tags & modules.
        </p>
      </header>

      <div class="row g-4">
        <!-- STORAGE SIZING -->
        <div class="col-12 col-lg-6">
          <div class="card shadow-sm">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <div>
                  <div class="section-title">Storage sizing</div>
                  <h2 class="h5 mb-0">TimescaleDB / Time-series storage</h2>
                </div>
                <span
                  class="badge bg-primary-subtle text-primary-emphasis results-badge"
                >
                  Raw Timeseries Data Storage
                </span>
              </div>

              <form id="storageForm" class="mt-3">
                <div class="row g-3">
                  <div class="col-6">
                    <label class="form-label">Number of Assets</label>
                    <input
                      type="number"
                      class="form-control"
                      id="stAssets"
                      min="1"
                      value="20"
                      required
                    />
                  </div>
                  <div class="col-6">
                    <label class="form-label">Tags per assets (avg)</label>
                    <input
                      type="number"
                      class="form-control"
                      id="stTagsPerAsset"
                      min="1"
                      value="200"
                      required
                    />
                  </div>

                  <div class="col-6">
                    <label class="form-label">
                      Updates per minute per tag (avg)
                    </label>
                    <input
                      type="number"
                      class="form-control"
                      id="stUpdatesPerMinPerTag"
                      min="0.01"
                      step="0.01"
                      value="1"
                      required
                    />
                    <div class="form-text">
                      Use 1 for once per minute, 0.1 for once per 10 min, etc.
                    </div>
                  </div>

                  <div class="col-6">
                    <label class="form-label">Retention period (months)</label>
                    <input
                      type="number"
                      class="form-control"
                      id="stRetentionMonths"
                      min="1"
                      value="6"
                      required
                    />
                  </div>

                  <div class="col-6">
                    <label class="form-label">Row size (bytes)</label>
                    <input
                      type="number"
                      class="form-control"
                      id="stRowSizeBytes"
                      min="1"
                      value="32"
                      required
                    />
                    <div class="form-text">
                      Timestamp + value + tag id + overhead (adjust as needed).
                    </div>
                  </div>

                  <div class="col-6">
                    <label class="form-label">Compression ratio</label>
                    <input
                      type="number"
                      class="form-control"
                      id="stCompressionRatio"
                      min="0.01"
                      max="1"
                      step="0.05"
                      value="0.4"
                    />
                    <div class="form-text">
                      0.4 = 60% reduction, 1 = no compression.
                    </div>
                  </div>
                </div>

                <div class="mt-3 d-flex justify-content-between">
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                    id="stResetBtn"
                  >
                    Reset defaults
                  </button>
                  <button
                    type="button"
                    class="btn btn-primary"
                    id="stCalculateBtn"
                  >
                    Calculate storage
                  </button>
                </div>
              </form>

              <hr class="my-3" />

              <div id="storageResults" class="small">
                <p class="text-muted mb-1 small-label">Results</p>
                <div class="fw-semibold" id="stSummaryLine">
                  No calculation yet.
                </div>
                <ul class="mt-2 mb-1 ps-3">
                  <li>
                    Total tags:
                    <span class="fw-semibold" id="stTotalTags">–</span>
                  </li>
                  <li>
                    Events per day:
                    <span class="fw-semibold" id="stEventsPerDay">–</span>
                  </li>
                  <li>
                    Total rows over retention:
                    <span class="fw-semibold" id="stTotalRows">–</span>
                  </li>
                </ul>

                <div class="row g-2 mt-1">
                  <div class="col-6">
                    <div class="border rounded p-2">
                      <div class="small-label mb-1">Uncompressed</div>
                      <div class="fw-semibold">
                        <span id="stUncompressedGB">–</span> GB
                      </div>
                      <div class="text-muted" id="stUncompressedTB"></div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="border rounded p-2">
                      <div class="small-label mb-1">Estimated compressed</div>
                      <div class="fw-semibold">
                        <span id="stCompressedGB">–</span> GB
                      </div>
                      <div class="text-muted" id="stCompressedTB"></div>
                    </div>
                  </div>
                </div>

                <div class="alert alert-info mt-3 mb-0 small">
                  These numbers are approximate and assume constant update rate
                  and average row size. Tune the parameters above to match your
                  real workload and Timescale settings.
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- COMPUTE SIZING -->
        <div class="col-12 col-lg-6">
          <div class="card shadow-sm">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <div>
                  <div class="section-title">Compute sizing</div>
                  <h2 class="h5 mb-0">CPU & RAM estimation</h2>
                </div>
                <span
                  class="badge bg-success-subtle text-success-emphasis results-badge"
                >
                  MES Module
                </span>
              </div>

              <form id="computeForm" class="mt-3">
                <div class="row g-3">
                  <div class="col-6">
                    <label class="form-label"
                      >#Months of Process Data retention</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="cpRetention"
                      min="6"
                      value="6"
                      required
                    />
                    <div class="form-text">
                      Used to calculate process data storage.
                    </div>
                  </div>

                  <div class="col-6">
                    <label class="form-label">Environment</label>
                    <select class="form-select" id="cpEnvironment">
                      <option value="0.5">Dev / Sandbox (x0.5)</option>
                      <option value="0.75">Test / QA (x0.75)</option>
                      <option value="1" selected>Production (x1)</option>
                      <option value="1.25">
                        Production (high SLA) (x1.25)
                      </option>
                    </select>
                  </div>

                  <div class="col-12">
                    <div
                      class="d-flex justify-content-between align-items-center mb-1"
                    >
                      <label class="form-label mb-0">Enabled modules</label>
                      <span class="small-label">
                        Each module adds load using its factor.
                      </span>
                    </div>
                    <div class="module-list small" id="moduleList">
                      <!-- checkboxes rendered by JS -->
                    </div>
                    <div class="form-text">
                      Base "Core MES" is always included. You can tweak factors
                      in JS.
                    </div>
                  </div>
                </div>

                <div class="mt-3 d-flex justify-content-between">
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                    id="cpResetBtn"
                  >
                    Reset defaults
                  </button>
                  <button
                    type="button"
                    class="btn btn-success"
                    id="cpCalculateBtn"
                  >
                    Calculate compute
                  </button>
                </div>
              </form>

              <hr class="my-3" />

              <div id="computeResults" class="small">
                <p class="text-muted mb-1 small-label">Results</p>
                <div class="fw-semibold" id="cpSummaryLine">
                  No calculation yet.
                </div>

                <div class="row g-2 mt-2">
                  <div class="col-6">
                    <div class="border rounded p-2">
                      <div class="small-label mb-1">
                        Recommended Cores/ vCPU/ Threads
                      </div>
                      <div class="fw-semibold">
                        <span id="cpCores">–</span>
                      </div>
                      <div class="text-muted small">
                        Base:
                        <span id="cpBaseCores">–</span>, Modules & assets:
                        <span id="cpCoreMultiplier">–</span>x
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="border rounded p-2">
                      <div class="small-label mb-1">Recommended RAM</div>
                      <div class="fw-semibold">
                        <span id="cpRamGB">–</span> GB
                      </div>
                      <div class="text-muted small">
                        Base:
                        <span id="cpBaseRamGB">–</span> GB, Modules & assets:
                        <span id="cpRamMultiplier">–</span>x
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="border rounded p-2">
                      <div class="small-label mb-1">
                        Recommended Process Storage (1 year)
                      </div>
                      <div class="fw-semibold">
                        <span id="cpStorageGB">–</span> GB
                      </div>
                      <div class="text-muted small">
                        Base:
                        <span id="cpBaseStorageGB">–</span> GB
                      </div>
                    </div>
                  </div>
                </div>

                <div class="alert alert-warning mt-3 mb-0 small">
                  This is a heuristic sizing model to start conversations with
                  infra teams. Adjust base values and factors in the JS config
                  to reflect your own benchmarks.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer class="text-center mt-4 small text-muted">
        Built for MES sizing experiments – adjust constants in JS to match your
        stack.
      </footer>
    </div>

    <!-- Bootstrap JS (optional, for nicer UI) -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script src="/main.js"></script>
  </body>
</html>
